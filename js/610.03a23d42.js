"use strict";(self["webpackChunkcloud_music"]=self["webpackChunkcloud_music"]||[]).push([[610],{7820:function(t,s,i){i.d(s,{Z:function(){return d}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"GoTop",class:t.isGoTopShow?"showBtn":t.isFirstLoad?"":"hideBtn",on:{click:t.goTop}},[s("i",{staticClass:"iconfont icon-huidaodingbu"})])},a=[];let l;var o={name:"GoTop",props:{scrollObj:{type:String,default(){return""}}},data(){return{isGoTopShow:!1,isFirstLoad:!0}},methods:{goTop(){this.el.scrollTo({behavior:"smooth",top:0})}},mounted(){""==this.scrollObj?(l=document,this.el=document.documentElement):(l=document.querySelector(this.scrollObj),this.el=l),l.onscroll=t=>{this.el.scrollTop>=500&&0==this.isGoTopShow?(this.isGoTopShow=!0,this.isFirstLoad&&(this.isFirstLoad=!1)):this.el.scrollTop<500&&this.isGoTopShow&&(this.isGoTopShow=!1)}}},r=o,c=i(1001),n=(0,c.Z)(r,e,a,!1,null,"07f39774",null),d=n.exports},7610:function(t,s,i){i.r(s),i.d(s,{default:function(){return f}});i(7658);var e=function(){var t=this,s=t._self._c;return t.musicListDetail?s("div",{staticClass:"musicListDetail"},[s("div",{staticClass:"listInfo"},[s("div",{staticClass:"listAvatar"},[s("img",{attrs:{src:t.musicListDetail.coverImgUrl,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"title"},[s("div",{staticClass:"titleTag"},[t._v("歌单")]),s("div",{staticClass:"titleContent"},[t._v(t._s(t.musicListDetail.name))])]),s("div",{staticClass:"user"},[s("div",{staticClass:"userAvatar"},[s("img",{attrs:{src:t.musicListDetail.creator.avatarUrl,alt:""}})]),s("div",{staticClass:"userName",on:{click:function(s){return t.$router.push({name:"personal",params:{uid:t.musicListDetail.creator.userId}})}}},[t._v(" "+t._s(t.musicListDetail.creator.nickname)+" ")]),s("div",{staticClass:"createTime"},[t._v(" "+t._s(t._f("showDate")(t.musicListDetail.createTime))+"创建 ")])]),s("div",{staticClass:"buttons"},[s("div",{staticClass:"buttonItem playAll",on:{click:t.playAll}},[s("i",{staticClass:"iconfont icon-yinle"}),s("span",[t._v("播放全部")])])]),s("div",{staticClass:"tags"},[t._v(" 标签： "),t._l(t.musicListDetail.tags,(function(i,e){return s("div",{key:e,staticClass:"tagItem"},[t._v(" "+t._s(i)+" ")])})),0==t.musicListDetail.tags.length?s("div",[t._v("暂无标签")]):t._e()],2),s("div",{staticClass:"otherInfo"},[s("div",{staticClass:"musicNum"},[t._v(" 歌曲 : "+t._s(t._f("handleNum")(t.musicListDetail.trackCount))+" ")]),s("div",{staticClass:"playCount"},[t._v(" 播放 : "+t._s(t._f("handleNum")(t.musicListDetail.playCount))+" ")])]),s("div",{staticClass:"desc"},[t._v(" 简介 : "+t._s(t.musicListDetail.description?t.musicListDetail.description:"暂无简介")+" ")])])]),s("div",{staticClass:"musicList"},[s("el-tabs",{attrs:{value:"first"},on:{"tab-click":t.clickTab}},[s("el-tab-pane",{attrs:{label:"歌曲列表",name:"first"}},[s("el-table",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:this.$store.state.isLogin?t.loadMore:"",expression:"this.$store.state.isLogin ? loadMore : ''"}],staticStyle:{width:"100%"},attrs:{data:t.musicListDetail.tracks,size:"mini","highlight-current-row":"",stripe:"",lazy:"","row-key":t=>t.id,"infinite-scroll-disabled":t.scrollLoadDisabled,"infinite-scroll-distance":1500,"infinite-scroll-immediate":!1},on:{"row-dblclick":t.clickRow,"cell-click":t.clickCell}},[s("el-table-column",{attrs:{label:"",width:"40",type:"index",index:t.handleIndex}}),s("el-table-column",{attrs:{prop:"name",label:"音乐标题","min-width":"350"}}),s("el-table-column",{attrs:{prop:"ar[0].name",label:"歌手","min-width":"120"}}),s("el-table-column",{attrs:{prop:"al.name",label:"专辑","min-width":"170"}}),s("el-table-column",{attrs:{prop:"dt",label:"时长","min-width":"100"}})],1),t.isMore&&!this.$store.state.isLogin?s("div",{staticClass:"loadMore"},[t._v(" 登陆后查看更多音乐 ")]):s("div",{staticClass:"placeholder"})],1),s("el-tab-pane",{attrs:{label:"收藏者",name:"third"}},[s("user-list-card",{attrs:{userType:"musicListDetailPage",userList:t.followedsListData.followedsList,isLoad:t.followedsListData.isMore},on:{bottomLoad:t.bottomLoad}}),0==t.followedsListData.followedsList.length&&1==t.followedsListData.isLoaded?s("div",{staticClass:"tips"},[t._v(" 暂无收藏者 ")]):t._e()],1)],1)],1),s("go-top",{attrs:{scrollObj:".musicListDetail"}})],1):t._e()},a=[],l=i(3214),o=i(7820),r=function(){var t=this,s=t._self._c;return s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"UserListCard",attrs:{"infinite-scroll-disabled":t.disabled,"infinite-scroll-distance":300,"infinite-scroll-immediate":!1}},t._l(t.userList,(function(i,e){return s("div",{key:e,staticClass:"userItemContainer",on:{click:function(s){return t.clickUser(i.userId)}}},[s("div",{staticClass:"userItem"},[s("div",{staticClass:"left"},[s("img",{staticClass:"avatar",attrs:{src:i.avatarUrl+"?param=200y200",alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"nickName"},[t._v(t._s(i.nickname))]),s("div",{staticClass:"signature"},[t._v(" "+t._s(i.signature)+" ")]),"personalPage"==t.userType?s("div",{staticClass:"nums"},[s("div",{staticClass:"musicListNum"},[t._v(t._s("歌单: "+i.playlistCount))]),s("div",{staticClass:"fenge"},[t._v("|")]),s("div",{staticClass:"followedsNum"},[t._v(t._s("粉丝: "+i.followeds))])]):t._e()])])])})),0)},c=[],n={name:"UserListCard",props:{userList:{type:Array,default(){return[]}},isLoad:{type:Boolean,default(){return!1}},userType:{type:String,default(){return"personalPage"}}},data(){return{disabled:!0}},methods:{clickUser(t){this.$router.push({name:"personal",params:{uid:t}})},load(){this.$emit("bottomLoad"),this.disabled=!0}},watch:{userList(){1==this.isLoad&&(0!=this.userList.length?this.disabled=!1:this.disabled=!0)}}},d=n,u=i(1001),m=(0,u.Z)(d,r,c,!1,null,"2ba159b5",null),h=m.exports,L={name:"MusicListDetail",data(){return{musicListDetail:null,comments:{},currentCommentPage:1,isMore:!1,isSub:!1,isCreated:!1,isCommentLoading:!1,scrollLoadDisabled:!1,followedsListData:{currentPage:1,followedsList:[],isMore:!1,isLoaded:!1}}},components:{GoTop:o.Z,UserListCard:h},methods:{async getMusicListDetail(){var t=Date.parse(new Date);let s=await this.$request("/playlist/detail",{id:this.$route.params.id,timestamp:t});this.musicListDetail=s.data.playlist,this.musicListDetail.tracks.length!=this.musicListDetail.trackIds.length&&(this.isMore=!0),this.musicListDetail.tracks.forEach(((t,s)=>{this.musicListDetail.tracks[s].dt=(0,l.oF)(t.dt)}))},async getMusicListComment(t){var s=Date.parse(new Date);this.isCommentLoading=!0,"changePage"==t&&this.scrollToComment();let i=await this.$request("/comment/playlist",{id:this.$route.params.id,offset:50*(this.currentCommentPage-1),limit:50,timestamp:s});console.log(i),200!==i.data.code&&this.$message.error("获取评论失败,请稍后重试!"),this.comments=i.data,this.isCommentLoading=!1,console.log("重新歌单获取评论")},scrollToComment(){let t=document.querySelector(".musicListDetail"),s=document.querySelector(".listInfo");t.scrollTo({behavior:"smooth",top:s.clientHeight-20})},async getMusicDetail(t){if(0==this.isMore)return;this.scrollLoadDisabled=!0;let s=await this.$request("/song/detail",{ids:t});console.log(s),s.data.songs.forEach(((t,i)=>{s.data.songs[i].dt=(0,l.oF)(t.dt)})),this.musicListDetail.tracks.push(...s.data.songs),this.musicListDetail.tracks.length<this.musicListDetail.trackIds.length?(this.isMore=!0,this.scrollLoadDisabled=!1):this.isMore=!1},async getUserMusicList(){let t=Date.parse(new Date);this.userInfo=window.localStorage.getItem("userInfo")&&JSON.parse(window.localStorage.getItem("userInfo"));let s=await this.$request("/user/playlist",{uid:this.userInfo.userId,timestamp:t});s=s.data.playlist;let i=s.findIndex((t=>1==t.subscribed));this.collectedMusicList=s.slice(i),this.$store.commit("updateCollectMusicList",this.collectedMusicList)},async getMusicListFolloweds(){let t=await this.$request("/playlist/subscribers",{id:this.$route.params.id,offset:20*(this.followedsListData.currentPage-1)});console.log(t),this.followedsListData.isMore=t.data.more,this.followedsListData.followedsList.push(...t.data.subscribers)},handleIndex(t){return t+=1,t<10?"0"+t:t},async clickRow(t){console.log(t),this.$store.commit("updateMusicId",t.id),this.musicListDetail.id!=this.$store.state.musicListId&&this.$store.commit("updateMusicList",{musicList:this.musicListDetail.tracks,musicListId:this.musicListDetail.id})},playAll(){this.$store.commit("updateMusicId",this.musicListDetail.tracks[0].id),this.$store.commit("updateMusicList",{musicList:this.musicListDetail.tracks,musicListId:this.musicListDetail.id})},commentPageChange(t){this.currentCommentPage=t,this.getMusicListComment("changePage")},handleDOM(t,s){if(document.querySelector(".musicListDetail")){let i=document.querySelector(".musicListDetail").querySelectorAll(".el-table__row"),e=this.musicListDetail.tracks.findIndex((s=>s.id==t));if(-1!=e&&(i[e].children[0].querySelector(".cell").innerHTML='<div><i class="iconfont icon-yinle"></i></div>',i[e].children[0].querySelector(".iconfont").classList.add("currentRow"),i[e].children[1].querySelector(".cell").classList.add("currentRow")),-1!=s){let t=this.musicListDetail.tracks.findIndex((t=>t.id==s));-1!=t&&(i[t].children[0].querySelector(".cell").innerHTML=`<div>${t+1<10?"0"+(t+1):t+1}</div>`,i[t].children[1].querySelector(".cell").classList.remove("currentRow"))}}},clickTab(t){console.log(t.index),1!=t.index||this.comments.comments?2!=t.index||this.followedsListData.isLoaded||(this.getMusicListFolloweds(),this.followedsListData.isLoaded=!0):this.getMusicListComment()},loadMore(){if(!this.$store.state.isLogin)return void this.$message.error("请先进行登录操作!");let t=this.musicListDetail.trackIds.slice(this.musicListDetail.tracks.length);t.length>100&&(t=t.slice(0,100));let s="";t.forEach((t=>{s+=t.id+","})),s=s.substr(0,s.length-1),this.getMusicDetail(s)},getIsSub(){this.isSub=this.$store.state.collectMusicList.find((t=>t.id==this.$route.params.id))},getIsCreated(){this.isCreated=this.$store.state.createdMusicList.find((t=>t.id==this.$route.params.id))},async collectList(){if(!this.$store.state.isLogin)return;this.isSub=!this.isSub;let t=Date.parse(new Date);await this.$request("/playlist/subscribe",{id:this.$route.params.id,t:this.isSub?1:2,timestamp:t}),this.getUserMusicList()},async clickCell(t,s,i){if(i.querySelector(".icon-download")){console.log(t);let s=await this.$request("/song/url",{id:t.id});if(console.log(s.data.data[0].url),console.log(s),null==s.data.data[0].url)return void this.$message.warning("暂时无法获取该资源哦!");let i=s.data.data[0].url.match(/\http.*?\.net/),e=i[0].match(/http:\/(\S*).music/)[1];if("/m7"!=e&&"/m701"!=e&&"/m8"!=e&&"/m801"!=e)return void this.$message.error("匹配不到对应的代理,下载失败!");let a=s.data.data[0].url.slice(i[0].length),l={url:e+a,name:t.name+" - "+t.ar[0].name+"."+s.data.data[0].type.toLowerCase()};console.log(l),this.$store.commit("updateDownloadMusicInfo",l)}},bottomLoad(){this.followedsListData.currentPage+=1,this.getMusicListFolloweds()}},computed:{},watch:{"$store.state.musicId"(t,s){this.handleDOM(t,s)},"$store.state.createdMusicList"(t,s){0==s.length&&this.getIsSub()}},filters:{showDate(t){const s=new Date(t);return(0,l.p6)(s,"yyyy-MM-dd")},handleNum:l.xw},created(){},async mounted(){this.$store.state.isLogin&&(this.getIsCreated(),this.isCreated||this.getIsSub()),await this.getMusicListDetail(),this.$nextTick((()=>{this.$route.params.id==this.$store.state.musicListId&&this.handleDOM(this.$store.state.musicId)}))}},p=L,g=(0,u.Z)(p,e,a,!1,null,"325d9f3c",null),f=g.exports},3214:function(t,s,i){function e(t){t=parseInt(t),t=t>1e4?Math.floor(t/1e3):Math.floor(t);let s=Math.floor(t/60),i=Math.floor(t%60);return s=s<10?"0"+s:s,i=i<10?"0"+i:i,s+":"+i}function a(){return Date.now()}function l(t){t=t.split(":");let s=parseInt(t[0]),i=parseInt(t[1]);return 60*s+i}function o(t,s){/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));let i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(let e in i)if(new RegExp(`(${e})`).test(s)){let t=i[e]+"";s=s.replace(RegExp.$1,1===RegExp.$1.length?t:c(t))}return s}function r(t){return t>1e4?(t=(t/1e4).toFixed(1),t+"万"):t}function c(t){return("00"+t).substr(t.length)}i.d(s,{J4:function(){return l},dg:function(){return a},oF:function(){return e},p6:function(){return o},xw:function(){return r}})}}]);
//# sourceMappingURL=610.03a23d42.js.map